<div id="mobile-menu" class="fixed inset-0 z-50 md:hidden pointer-events-none">
  <!-- Backdrop -->
  <div
    id="mobile-menu-backdrop"
    class="absolute inset-0 bg-black/40 opacity-0 transition-opacity duration-300">
  </div>

  <!-- Sliding panel -->
  <aside
    id="mobile-menu-panel"
    role="dialog"
    aria-modal="true"
    aria-labelledby="mobile-menu-title"
    class="absolute right-0 top-0 h-full w-4/5 max-w-sm
           bg-white shadow-xl
           translate-x-full
           transition-transform duration-300 ease-out">
    <h2 id="mobile-menu-title" class="sr-only">Navigation menu</h2>

    <nav class="flex flex-col p-6 space-y-6 text-lg">
      <a href="/" data-close-menu>Home</a>
      <a href="/services" data-close-menu>Services</a>
      <a href="/about" data-close-menu>About</a>
      <a href="/contact" data-close-menu>Contact</a>
    </nav>
  </aside>
</div>

<script>
  const menu = document.getElementById("mobile-menu") as HTMLElement;
  const panel = document.getElementById("mobile-menu-panel") as HTMLElement;
  const openButton = document.getElementById(
    "mobile-menu-button"
  ) as HTMLElement;
  const backdrop = document.getElementById(
    "mobile-menu-backdrop"
  ) as HTMLElement;

  let lastFocusedElement = null;

  function openMenu() {
    lastFocusedElement = document.activeElement;

    document.body.classList.add("menu-open");

    menu?.classList.remove("pointer-events-none", "hidden");
    backdrop?.classList.remove("opacity-0");

    openButton.setAttribute("aria-expanded", "true");
    openButton.setAttribute("aria-label", "Close menu");

    setTimeout(() => {
      panel?.classList.remove("translate-x-full");

      const focusableElements = getFocusableElements(panel);
      focusableElements[0]?.focus();
    }, 10);

    document.addEventListener("keydown", handleKeydown);
  }

  function closeMenu() {
    document.body.classList.remove("menu-open");

    panel?.classList.add("translate-x-full");
    backdrop?.classList.add("opacity-0");

    document.removeEventListener("keydown", handleKeydown);

    openButton.setAttribute("aria-expanded", "false");
    openButton.setAttribute("aria-label", "Open menu");

    setTimeout(() => {
      menu?.classList.add("hidden");
    }, 300);
  }

  function getFocusableElements(container: HTMLElement): HTMLElement[] {
    const elements = container.querySelectorAll<HTMLElement>(
      'a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])'
    );
    return Array.from(elements);
  }

  function handleKeydown(e: KeyboardEvent) {
    if (e.key === "Escape") {
      closeMenu();
      return;
    }

    if (e.key !== "Tab") return;

    const focusables = getFocusableElements(panel);
    const first = focusables[0];
    const last = focusables[focusables.length - 1];

    if (e.shiftKey && document.activeElement === first) {
      e.preventDefault();
      last.focus();
    } else if (!e.shiftKey && document.activeElement === last) {
      e.preventDefault();
      first.focus();
    }
  }

  openButton?.addEventListener("click", openMenu);
  backdrop?.addEventListener("click", closeMenu);

  document
    .querySelectorAll<HTMLElement>("[data-close-menu]")
    .forEach((link) => {
      link.addEventListener("click", closeMenu);
    });
</script>
